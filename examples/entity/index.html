<!doctype html>
<html>

<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">

    <title>Roguelike JS Skeleton - Examples - Entity</title>

    <link rel="stylesheet" href="../assets/css/style.css" type="text/css">
    <link rel="stylesheet" href="../assets/css/prism.css" type="text/css">
</head>

<body>
    <div class="container">
        <a href="../../docs/classes/Entity.html" class="btn btn-primary pull-right">Entity API Docs</a>
        <h1 class="page-title">Roguelike JS Skeleton - <a href="../../index.html#examples">Examples</a> - Entity</h1>

        <div class="section row">
            <div class="col-md-4 panel panel-default">
                <div class="panel-heading">
                    Contents
                </div>
                <div class="panel-body">
                    <ol>
                        <li><a href="#basic-movement-behavior">Basic Movement Behavior</a></li>
                    </ol>
                </div>
            </div>
            <div class="col-md-8 panel panel-default">
                <div class="panel-heading">
                    <strong>Setup Code</strong> (Run before all examples)
                    <a href="#" class="btn btn-primary btn-toggle-setup pull-right">Show</a>
                </div>
                <pre class="setup-code">
                    <code class="language-javascript">
var initBasicGame = function(mapContainerEl, mapData){

    var keyBindings = {
        up: ['UP_ARROW', 'K', 'W'],
        down: ['DOWN_ARROW', 'J', 'S'],
        left: ['LEFT_ARROW', 'H', 'A'],
        right: ['RIGHT_ARROW', 'L', 'D'],
        wait: ['SPACE']
    };

    var mapCharToType = {
        '#': 'wall',
        '.': 'floor'
    };

    // create the game instance
    var game = new RL.Game();
    // generate and assign a map object (repaces empty default)

    game.map.loadTilesFromArrayString(mapData, mapCharToType, 'floor');

    game.setMapSize(game.map.width, game.map.height);

    // add input keybindings
    game.input.addBindings(keyBindings);

    // set player starting position
    game.player.x = 5;
    game.player.y = 3;

    // append elements created by the game to the DOM
    mapContainerEl.appendChild(game.renderer.canvas);
    window.game = game;
    return game;
};
                    </code>
                </pre>
            </div>
        </div>

        <div id="basic-movement-behavior" class="section row">
            <div class="col-md-12 panel panel-default">
                <div class="panel-heading">
                    Basic Movement Behavior (and an attached light just for fun)
                </div>
                <div class="panel-body">
                    <p>Move the player around and watch how the zombie behaves. Move the player around with the W, A, S, D instead of arrow keys to avoid scrolling the window. Use SPACE to skip the players turn.</p>
                </div>
            </div>
            <div class="col-md-4 panel panel-default">
                <div class="panel-heading">
                    Game
                </div>

                <div id="ex-1-container" class="map-container game-container"></div>

            </div>

            <div class="col-md-8 panel panel-default ex-code-container">
                <div class="panel-heading ex-controls">
                    Example Code
                    <span class="pull-right">
                        <a href="#" class="btn btn-primary ex-btn-run">Run</a>
                        <a href="#" class="btn btn-primary ex-btn-edit">Edit</a>
                        <a href="#" class="btn btn-primary ex-btn-view">View</a>
                        <a href="#" class="btn btn-primary ex-btn-toggle">Show</a>
                    </span>
                </div>
                <div class="ex-code">
                    <pre>
                        <code class="language-javascript">
var mapData = [
    '##########',
    '#........#',
    '#........#',
    '#........#',
    '#........#',
    '##########',
];
var containerEl = document.getElementById('ex-1-container');
containerEl.innerHTML = '';
var game = initBasicGame(containerEl, mapData);

// Define an Entity Type
RL.Entity.Types.zombie = {
    name: 'Zombie',
    char: 'z',
    color: 'red',
    bgColor: '#222',
    pushable: false,
    currentDirection: 'right',
    light_r: 50,
    light_g: 50,
    light_b: 255,

    initialize: function(){

    },

    /**
    * Gets the adjustment coord from a direction string.
    * @method directionToAdjustCoord
    * @param {String} direction - The current direction.
    * @return {Object} {x: 0, y: 0}
    */
    directionToAdjustCoord: function(direction){
        var directionCoords = {
            up:     {x: 0, y:-1},
            right:  {x: 1, y: 0},
            down:   {x: 0, y: 1},
            left:   {x:-1, y: 0}
        };
        return directionCoords[direction];
    },

    /**
    * Gets the next direction in the list
    * @method getNextDirection
    * @param {String} direction - The current direction.
    * @return {String}
    */
    getNextDirection: function(currentDirection){
        var directions = ['up', 'right', 'down', 'left'],
            currentDirIndex = directions.indexOf(currentDirection),
            newDirIndex;
        // if currentDirection is not valid or is the last in the array use the first direction in the array
        if(currentDirIndex === -1 || currentDirIndex === directions.length - 1){
            newDirIndex = 0;
        } else {
            newDirIndex = currentDirIndex + 1;
        }
        return directions[newDirIndex];
    },

    /**
    * Called every turn by the entityManger (entity turns are triggered after player actions are complete)
    * @method update
    */
    update: function(){
        var startDir = this.currentDirection,
            currentDir = this.currentDirection;

        var i = 0;
        while(i < 6){
            i++;
            var currentDirAdjustCoords = this.directionToAdjustCoord(currentDir),
                targetX = this.x + currentDirAdjustCoords.x,
                targetY = this.y + currentDirAdjustCoords.y;

            if(this.canMoveTo(targetX, targetY)){
                this.currentDirection = currentDir;
                this.moveTo(targetX, targetY);
                return;
            }
            currentDir = this.getNextDirection(currentDir);
            // give up if all directions attempted
            if(currentDir === startDir){
                return false;
            }
        }
    },

    /**
    * Changes the position of this entity on the map.
    * @method moveTo
    * @param {Number} x - The tile map x coord to move to.
    * @param {Number} y - The tile map y coord to move to.
    */
    moveTo: function(x, y) {
        // remove light from current position
        if(this.game.lighting.get(this.x, this.y)){
            this.game.lighting.remove(this.x, this.y);
        }
        // add to new position
        this.game.lighting.set(x, y, this.light_r, this.light_g, this.light_b);
        this.game.entityManager.move(x, y, this);
    },
};
// create an instance of entity with the type zombie
var entity = new RL.Entity(game, 'zombie');
// add it to the game
game.entityManager.add(1, 1, entity);
game.start();
                            </code>
                        </pre>
                        <textarea class="ex-code-input"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/js/prism.js"></script>

    <script src="../assets/js/rot.js"></script>

    <script src="../../src/rl.js"></script>
    <script src="../../src/util.js"></script>
    <script src="../../src/array-2d.js"></script>
    <script src="../../src/map.js"></script>
    <script src="../../src/entity.js"></script>
    <script src="../../src/entity-manager.js"></script>
    <script src="../../src/input.js"></script>
    <script src="../../src/mouse.js"></script>
    <script src="../../src/player.js"></script>
    <script src="../../src/renderer.js"></script>
    <script src="../../src/tile.js"></script>
    <script src="../../src/console.js"></script>
    <script src="../../src/fov-rot.js"></script>
    <script src="../../src/lighting-rot.js"></script>
    <script src="../../src/game.js"></script>

    <script src="main.js"></script>
    <script src="../assets/js/example.js"></script>

</body>

</html>
